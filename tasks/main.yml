---

# Main tasks file for shinken role

- name: 'INIT | Manage variables to use for our target'
  include: "{{ role_path }}/tasks/manage_variables.yml"
  tags:
    - 'role::shinken'
    - 'role::shinken::config'
    - 'role::shinken::init'
    - 'role::shinken::install'
    - 'role::shinken::upgrade_config'


- name: 'INIT | Manage Shinken installation tasks'
  include: "{{ role_path }}/tasks/installation.yml"
  tags:
    - 'role::shinken'
    - 'role::shinken::config'
    - 'role::shinken::init'
    - 'role::shinken::install'


- name: 'INIT | Manage Shinken configuration tasks'
  include: "{{ role_path }}/tasks/configuration.yml"
  tags:
    - 'role::shinken'
    - 'role::shinken::config'
    - 'role::shinken::init'
    - 'role::shinken::install'
    - 'role::shinken::upgrade_config'


- name: 'INIT | Check daemon state is good'
  become: True
  service:
    name: "shinken-{{ item.key }}"
    state: "{{ item.value.started | ternary('started', 'stopped') }}"
  with_dict: "{{ shinken_daemons }}"
  tags:
    - 'role::shinken'
    - 'role::shinken::config'
    - 'role::shinken::init'
    - 'role::shinken::install'
    - 'role::shinken::upgrade_config'
